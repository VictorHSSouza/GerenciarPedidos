@page "/gerenciar"
@page "/gerenciar-pedidos"
@using Atividade6_Blazor.Shared;
@using Atividade6_Blazor.Services;
@using Atividade6_Blazor.Models;

<PageTitle>Gerenciar Pedidos</PageTitle>

<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-5 fw-bold text-primary mb-1">
                        🛒 Gerenciar Pedidos
                    </h1>
                    <p class="text-muted mb-0">Controle completo dos seus pedidos</p>
                </div>
                <div>
                    <button class="btn @(BtnCriar ? "btn-outline-secondary" : "btn-primary") btn-lg px-4" 
                            @onclick="CriarPedido">
                        @if (BtnCriar)
                        {
                            <i class="bi bi-x-circle me-2"></i>@mensagem
                        }
                        else
                        {
                            <i class="bi bi-plus-circle me-2"></i>@mensagem
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    @if (BtnCriar)
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-pencil-square me-2"></i>
                            @(atualizar.Id > 0 ? "Editar Pedido" : "Novo Pedido")
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <FormularioPedido pedido="atualizar" AoAdicionar="AdicionarPedido" AoCancelar="CriarPedido"></FormularioPedido>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Pedidos List Section -->
    <div class="row">
        <div class="col-12">
            @if (pedidos.Any())
            {
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-secondary mb-0">
                        📋 Lista de Pedidos (@pedidos.Count)
                    </h4>
                </div>
                
                <div class="row g-3">
                    @foreach (var p in pedidos)
                    {
                        <div class="col-lg-6 col-xl-4">
                            <CardPedido pedido="p" OnRemover="RemoverPedido" OnEditar="Atualizar"></CardPedido>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <div class="mb-4">
                        <span class="display-1 text-muted">📦</span>
                    </div>
                    <h4 class="text-muted mb-2">Nenhum pedido encontrado</h4>
                    <p class="text-muted mb-4">Comece criando seu primeiro pedido!</p>
                    <button class="btn btn-primary btn-lg" @onclick="CriarPedido">
                        <i class="bi bi-plus-circle me-2"></i>Criar Primeiro Pedido
                    </button>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .card {
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
    }
    
    .btn {
        transition: all 0.2s ease;
    }
    
    .display-5 {
        font-weight: 700;
    }
</style>

@code {
    private PedidoService PedServ = new PedidoService();
    private List<Pedido> pedidos = new();
    private Pedido atualizar = new Pedido();
    private bool BtnCriar = false;
    private string mensagem = "Criar Pedido";


    protected override async Task OnInitializedAsync()
    {
        pedidos = PedServ.ObterTodosPedidos();
        await Task.Delay(1000);
    }

    public void CriarPedido()
    {
        if (BtnCriar)
        {
            atualizar = new Pedido();
            BtnCriar = false;
            mensagem = "Criar Pedido";
        }
        else
        {
            BtnCriar = true;
            mensagem = "Cancelar";
        }
    }

    public void RemoverPedido(Pedido pedido)
    {
        PedServ.RemoverPedido(pedido);
        BtnCriar = false;
    }


    public void Atualizar(Pedido pedido)
    {
        atualizar = pedido;
        BtnCriar = true;
    }

    public void AdicionarPedido(Pedido pedido)
    {
        if(PedServ.ObterPedidoPorId(pedido.Id) != null)
        {
            PedServ.AtualizarPedido(pedido);
        }
        else
        {
            PedServ.AdicionarPedido(pedido);
        }
        CriarPedido();
    }
}
